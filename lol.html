<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LG NewsChannel</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { background-color: #f8f9fa; }
    .news-item {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .news-item:hover { transform: scale(1.02); box-shadow: 0px 4px 15px rgba(0,0,0,0.2); }
    .urgent { border: 2px solid red; background-color: #ffe5e5; }
    .popup { border: 2px solid blue; background-color: #e5f0ff; }
    .news { border: 2px solid gray; background-color: #fff; }
    #popup-container {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        z-index: 1000;
    }
    .popup-message {
        background: white;
        border: 2px solid blue;
        padding: 10px;
        border-radius: 8px;
        animation: fadeInUp 0.5s ease;
        margin-top: 0.5rem;
    }
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
</head>
<body>

<div class="container py-4">
    <h1>üì¢ LG NewsChannel</h1>
    <button class="btn btn-secondary" onclick="toggleSettings()">‚öôÔ∏è Einstellungen</button>
    <div id="settings" style="display:none; margin-top: 1rem;">
        <label><input type="checkbox" id="showNews" checked> News anzeigen</label><br>
        <label><input type="checkbox" id="showPopups" checked> Popups anzeigen</label><br>
    </div>
    <hr>
    <div id="news-container"></div>
</div>

<div id="popup-container"></div>
<div id="popup-list" style="display:none; position:fixed; bottom:4rem; right:1rem; background:white; padding:1rem; border-radius:8px; border:1px solid #ccc;">
    <h5>Letzte Popups</h5>
    <div id="popup-history"></div>
</div>
<button id="show-popup-list" class="btn btn-primary" style="display:none; position:fixed; bottom:1rem; left:1rem;" onclick="togglePopupList()">üìú Popups anzeigen</button>

<script>
const NEWS_URL = "https://lg-newschannel.xo.je/news.php"; // Deine PHP-CORS-Proxy-Datei
let popupHistory = [];

function toggleSettings() {
    const s = document.getElementById("settings");
    s.style.display = s.style.display === "none" ? "block" : "none";
}

function togglePopupList() {
    const p = document.getElementById("popup-list");
    p.style.display = p.style.display === "none" ? "block" : "none";
}

async function loadNews() {
    try {
        const res = await fetch(NEWS_URL);
        const data = await res.json();
        renderNews(data);
    } catch (err) {
        console.error("Fehler beim Laden der Nachrichten:", err);
    }
}

function renderNews(newsArray) {
    const container = document.getElementById("news-container");
    container.innerHTML = "";
    const showNews = document.getElementById("showNews").checked;
    const showPopups = document.getElementById("showPopups").checked;

    newsArray.forEach(item => {
        const div = document.createElement("div");
        div.classList.add("news-item", item.type || "news");
        if (item.tag && item.tag.toLowerCase() === "dringend") {
            div.classList.add("urgent");
        }

        div.innerHTML = `
            <strong>${item.icon || "‚ÑπÔ∏è"} ${item.title || ""}</strong><br>
            ${item.message || ""}<br>
            <small>${item.author ? "Von " + item.author : ""}</small>
        `;

        if (item.type === "popup") {
            if (showPopups || (item.tag && item.tag.toLowerCase() === "dringend")) {
                showPopup(item);
            } else {
                popupHistory.push(item);
                document.getElementById("show-popup-list").style.display = "block";
            }
        }

        if (item.type === "news" && showNews) {
            container.appendChild(div);
        }
    });
}

function showPopup(item) {
    const popupContainer = document.getElementById("popup-container");
    const popup = document.createElement("div");
    popup.classList.add("popup-message");
    if (item.tag && item.tag.toLowerCase() === "dringend") {
        popup.style.borderColor = "red";
        popup.style.backgroundColor = "#ffe5e5";
    }
    popup.innerHTML = `<strong>${item.icon || "‚ÑπÔ∏è"} ${item.title || ""}</strong><br>${item.message}`;
    popupContainer.appendChild(popup);

    setTimeout(() => {
        popup.remove();
    }, 5000);
}

loadNews();
setInterval(loadNews, 60000); // alle 60 Sek. neu laden
</script>
</body>
</html> 
